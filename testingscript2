-- Script to create ESP with box and health bar for each player in the game
local Player = game.Players.LocalPlayer
local Drawing = game:GetService("Drawing")
local Camera = workspace.CurrentCamera

-- Function to create ESP for a given player
local function createESP(target)
    -- Create the ESP box and health bar
    local box = Drawing.new("Square")
    local healthBar = Drawing.new("Line")

    -- Set drawing properties
    box.Color = Color3.fromRGB(0, 255, 0)
    box.Thickness = 2
    box.Transparency = 1
    box.Filled = false

    healthBar.Color = Color3.fromRGB(0, 255, 0)
    healthBar.Thickness = 3
    healthBar.Transparency = 1

    -- Update ESP every frame
    game:GetService("RunService").RenderStepped:Connect(function()
        local char = target.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            -- Get the screen position of the player
            local pos, onScreen = Camera:WorldToViewportPoint(char.HumanoidRootPart.Position)
            
            -- Check if player is on screen
            if onScreen then
                -- Get player's health
                local health = target.Character.Humanoid.Health
                local maxHealth = target.Character.Humanoid.MaxHealth
                local healthPercent = health / maxHealth

                -- Draw the box around the player
                box.Size = Vector2.new(100, 150) -- Box size
                box.Position = Vector2.new(pos.X - box.Size.X / 2, pos.Y - box.Size.Y / 2)

                -- Draw the health bar beside the box
                healthBar.From = Vector2.new(pos.X + box.Size.X / 2 + 5, pos.Y - box.Size.Y / 2)
                healthBar.To = Vector2.new(pos.X + box.Size.X / 2 + 5, pos.Y - box.Size.Y / 2 + 150 * healthPercent)
                
            else
                -- Remove drawing if player is not on screen
                box.Visible = false
                healthBar.Visible = false
            end
        end
    end)
end

-- Run the ESP for each player
for _, player in ipairs(game.Players:GetPlayers()) do
    if player ~= Player then
        createESP(player)
    end
end

-- Update ESP for new players that join
game.Players.PlayerAdded:Connect(function(player)
    if player ~= Player then
        createESP(player)
    end
end)
